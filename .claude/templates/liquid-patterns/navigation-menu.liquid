{% comment %}
  Navigation Menu Snippet
  Usage: {% render 'navigation-menu', menu: linklists.main-menu %}
{% endcomment %}

<nav class="main-nav" aria-label="{{ menu.title }}">
  <ul class="main-nav__list">
    {% for link in menu.links %}
      <li class="main-nav__item{% if link.active %} main-nav__item--active{% endif %}">
        {% if link.links.size > 0 %}
          {%comment%} Dropdown menu {% endcomment %}
          <button
            class="main-nav__link main-nav__link--dropdown"
            aria-expanded="false"
            aria-controls="submenu-{{ link.handle }}"
          >
            {{ link.title }}
            <svg class="main-nav__arrow" width="12" height="8" aria-hidden="true">
              <path d="M1 1l5 5 5-5" stroke="currentColor" fill="none"/>
            </svg>
          </button>

          <ul class="main-nav__dropdown" id="submenu-{{ link.handle }}" hidden>
            {% for child_link in link.links %}
              <li class="main-nav__dropdown-item">
                <a
                  href="{{ child_link.url }}"
                  class="main-nav__dropdown-link"
                  {% if child_link.current %}aria-current="page"{% endif %}
                >
                  {{ child_link.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          {%comment%} Regular link {% endcomment %}
          <a
            href="{{ link.url }}"
            class="main-nav__link"
            {% if link.current %}aria-current="page"{% endif %}
          >
            {{ link.title }}
          </a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>

{% stylesheet %}
  .main-nav {
    position: relative;
  }

  .main-nav__list {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .main-nav__list {
      flex-direction: column;
    }
  }

  .main-nav__item {
    position: relative;
  }

  .main-nav__link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    text-decoration: none;
    color: var(--color-text, #000);
    font-weight: 500;
    transition: color 0.2s ease;
    background: none;
    border: none;
    font-size: 1rem;
    cursor: pointer;
  }

  .main-nav__link:hover {
    color: var(--color-primary, #0066cc);
  }

  .main-nav__item--active .main-nav__link {
    color: var(--color-primary, #0066cc);
  }

  .main-nav__link[aria-current="page"] {
    font-weight: 700;
  }

  .main-nav__arrow {
    transition: transform 0.2s ease;
  }

  .main-nav__link[aria-expanded="true"] .main-nav__arrow {
    transform: rotate(180deg);
  }

  /* Dropdown menu */
  .main-nav__dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 200px;
    background: var(--color-background, #fff);
    border: 1px solid var(--color-border, #e0e0e0);
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    list-style: none;
    margin: 0.5rem 0 0;
    padding: 0.5rem 0;
    z-index: 100;
  }

  @media (max-width: 768px) {
    .main-nav__dropdown {
      position: static;
      border: none;
      box-shadow: none;
      background: var(--color-muted-bg, #f5f5f5);
      margin: 0;
    }
  }

  .main-nav__dropdown-item {
    margin: 0;
  }

  .main-nav__dropdown-link {
    display: block;
    padding: 0.5rem 1rem;
    text-decoration: none;
    color: var(--color-text, #000);
    transition: background 0.2s ease;
  }

  .main-nav__dropdown-link:hover {
    background: var(--color-muted-bg, #f5f5f5);
  }

  .main-nav__dropdown-link[aria-current="page"] {
    font-weight: 700;
    color: var(--color-primary, #0066cc);
  }
{% endstylesheet %}

{% javascript %}
  // Toggle dropdown menus
  document.querySelectorAll('.main-nav__link--dropdown').forEach(button => {
    button.addEventListener('click', () => {
      const isExpanded = button.getAttribute('aria-expanded') === 'true';
      const dropdown = document.getElementById(button.getAttribute('aria-controls'));

      // Close all other dropdowns
      document.querySelectorAll('.main-nav__link--dropdown').forEach(otherButton => {
        if (otherButton !== button) {
          otherButton.setAttribute('aria-expanded', 'false');
          const otherDropdown = document.getElementById(otherButton.getAttribute('aria-controls'));
          if (otherDropdown) otherDropdown.hidden = true;
        }
      });

      // Toggle current dropdown
      button.setAttribute('aria-expanded', !isExpanded);
      dropdown.hidden = isExpanded;
    });
  });

  // Close dropdowns when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.main-nav')) {
      document.querySelectorAll('.main-nav__link--dropdown').forEach(button => {
        button.setAttribute('aria-expanded', 'false');
        const dropdown = document.getElementById(button.getAttribute('aria-controls'));
        if (dropdown) dropdown.hidden = true;
      });
    }
  });

  // Close dropdown on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('.main-nav__link--dropdown').forEach(button => {
        button.setAttribute('aria-expanded', 'false');
        const dropdown = document.getElementById(button.getAttribute('aria-controls'));
        if (dropdown) dropdown.hidden = true;
      });
    }
  });
{% endjavascript %}
